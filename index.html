<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tienda de Recetas</title>
<link rel="stylesheet" href="assets/css/bootstrap.min.css">
<link rel="icon" href="assets/media/img/icon.png">
<style>
    body { scroll-behavior: smooth; }
    .section-title { margin-top: 60px; }
    .price { font-weight: bold; color: #28a745; }
</style>
</head>
<body>

<!-- NAVBAR -->
<div class="container">
    <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
        <a href="#inicio" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
            <img src="assets/media/img/icon.png" alt="icono" height="32" class="me-2">
            <h3 class="m-0">Tienda de Recetas</h3>
        </a>
        <ul class="nav nav-pills">
            <li class="nav-item"><a href="#inicio" class="nav-link active">Principio</a></li>
            <li class="nav-item"><a href="#productos" class="nav-link">Productos</a></li>
            <li class="nav-item"><a href="#recetas" class="nav-link">Recetas</a></li>
            <li class="nav-item"><a href="#faq" class="nav-link">Preguntas Frecuentes</a></li>
            <li class="nav-item"><a href="#acerca" class="nav-link">Acerca de Nosotros</a></li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#cartModal">üõí Carrito <span id="cart-count" class="badge bg-success">0</span></a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#addRecipeModal">‚ûï Nueva Receta</a>
            </li>
        </ul>
    </header>
</div>

<!-- PRODUCTOS -->
<div class="container" id="productos">
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3" id="lista-recetas"></div>
</div>

<!-- RECETAS -->
<div class="container" id="recetas">
    <h2 class="section-title">Recetas</h2>
    <p>Aqu√≠ podr√°s editar las recetas y descripciones de tus platos.</p>
</div>

<!-- MODAL CARRITO -->
<div class="modal fade" id="cartModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Carrito de Compras</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body" id="cart-items"></div>
      <div class="modal-footer">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#checkoutModal">Pagar</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL PAGO -->
<div class="modal fade" id="checkoutModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Finalizar Compra</h5></div>
      <div class="modal-body">
        <input type="text" class="form-control mb-2" placeholder="Nombre completo">
        <input type="email" class="form-control mb-2" placeholder="Correo electr√≥nico">
        <input type="text" class="form-control mb-2" placeholder="Direcci√≥n de env√≠o">
        <select class="form-select mb-2">
            <option selected>M√©todo de pago</option>
            <option value="visa">üí≥ Tarjeta VISA</option>
            <option value="paypal">üí≤ PayPal</option>
            <option value="yape">üì± Yape</option>
            <option value="plin">üì± Plin</option>
        </select>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" onclick="alert('Compra confirmada. ¬°Gracias por tu pedido!')">Confirmar Compra</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL AGREGAR RECETA -->
<div class="modal fade" id="addRecipeModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Agregar Nueva Receta</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="form-receta">
          <div class="mb-3">
            <label class="form-label">Nombre</label>
            <input type="text" id="nombre" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Descripci√≥n</label>
            <textarea id="descripcion" class="form-control"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Imagen (URL)</label>
            <input type="text" id="imagen" class="form-control" placeholder="https://ejemplo.com/imagen.jpg">
          </div>
          <div class="mb-3">
            <label class="form-label">Precio (S/)</label>
            <input type="number" id="precio" class="form-control" step="0.01">
          </div>
          <button type="submit" class="btn btn-success">Guardar Receta</button>
        </form>
        <div id="mensaje" class="mt-3"></div>
      </div>
    </div>
  </div>
</div>

<script src="assets/js/bootstrap.bundle.min.js"></script>
<script>
const API_URL = "https://recetas-backend-rab7.onrender.com";
let carrito = [];

// Cargar recetas
async function cargarRecetas() {
    try {
        const respuesta = await fetch(`${API_URL}/recipes`);
        if (!respuesta.ok) throw new Error("Error al obtener recetas");
        const recetas = await respuesta.json();
        mostrarRecetas(recetas);
    } catch (error) {
        console.error("Error cargando recetas:", error);
    }
}

// Mostrar recetas
function mostrarRecetas(recetas) {
    const contenedor = document.getElementById("lista-recetas");
    contenedor.innerHTML = "";
    recetas.forEach(receta => {
        const tarjeta = document.createElement("div");
        tarjeta.className = "col";
        tarjeta.innerHTML = `
            <div class="card">
                <img src="${receta.imagen || 'assets/img/default.jpg'}" class="card-img-top" style="height: 250px; object-fit:cover;">
                <div class="card-body">
                    <h5 class="card-title text-center">${receta.nombre}</h5>
                    <p class="card-text">${receta.descripcion || ''}</p>
                    <p class="price">S/ ${receta.precio ? receta.precio.toFixed(2) : '0.00'}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <button class="btn btn-sm btn-outline-secondary" onclick="agregarAlCarrito('${receta.id}')">Comprar</button>
                    </div>
                </div>
            </div>
        `;
        contenedor.appendChild(tarjeta);
    });
}

// Agregar al carrito
function agregarAlCarrito(id) {
    carrito.push(id);
    document.getElementById("cart-count").innerText = carrito.length;
}

// Guardar receta
document.getElementById("form-receta").addEventListener("submit", async function(e) {
    e.preventDefault();

    const receta = {
        nombre: document.getElementById("nombre").value,
        descripcion: document.getElementById("descripcion").value,
        imagen: document.getElementById("imagen").value || "assets/img/default.jpg",
        precio: parseFloat(document.getElementById("precio").value) || 0
    };

    try {
        const res = await fetch(`${API_URL}/recipes/`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(receta)
        });

        if (!res.ok) throw new Error("Error al guardar receta");

        const data = await res.json();
        document.getElementById("mensaje").innerHTML = `
            <div class="alert alert-success">
                ‚úÖ Receta agregada correctamente (ID: ${data.id})
            </div>
        `;
        this.reset();
        cargarRecetas();
    } catch (error) {
        document.getElementById("mensaje").innerHTML = `
            <div class="alert alert-danger">
                ‚ùå Error: ${error.message}
            </div>
        `;
    }
});

document.addEventListener("DOMContentLoaded", cargarRecetas);
</script>
</body>
</html>


